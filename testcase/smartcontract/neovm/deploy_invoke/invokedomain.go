package deploy_invoke

import (
	"time"

	"github.com/ontio/ontology-go-sdk/utils"
	"github.com/ontio/ontology-test/testframework"
)

/*
using Neo.SmartContract.Framework;
using Neo.SmartContract.Framework.Services.Neo;
using Neo.SmartContract.Framework.Services.System;
using System;
using System.ComponentModel;
using System.Numerics;

namespace Neo.SmartContract
{
    public class Domain : Framework.SmartContract
    {
        public static object Main(string operation, params object[] args)
        {
            switch (operation)
            {
                case "Query":
                    return Query((string)args[0]);
                case "Register":
                    return Register((string)args[0], (byte[])args[1]);
                case "Transfer":
                    return Transfer((string)args[0], (byte[])args[1]);
                case "Delete":
                    return Delete((string)args[0]);
                default:
                    return false;
            }
        }

        public static byte[] Query(string domain)
        {
            return Storage.Get(Storage.CurrentContext, domain);
        }

        public static bool Register(string domain, byte[] owner)
        {
            byte[] value = Storage.Get(Storage.CurrentContext, domain);
            if (value != null) return false;
            Storage.Put(Storage.CurrentContext, domain, owner);
            return true;
        }

        public static bool Transfer(string domain, byte[] to)
        {
            byte[] from = Storage.Get(Storage.CurrentContext, domain);
            if (from == null) return false;
            if (!Runtime.CheckWitness(from)) return false;
            Storage.Put(Storage.CurrentContext, domain, to);
            return true;
        }

        public static bool Delete(string domain)
        {
            byte[] owner = Storage.Get(Storage.CurrentContext, domain);
            if (owner == null) return false;
            if (!Runtime.CheckWitness(owner)) return false;
            Storage.Delete(Storage.CurrentContext, domain);
            return true;
        }
    }
}


code = 54c56b6c766b00527ac46c766b51527ac4616c766b00c36c766b52527ac46c766b52c305517565727987633a006c766b52c308526567697374657287633d006c766b52c3085472616e73666572876348006c766b52c30644656c657465876355006267006c766b51c300c3616570006c766b53527ac4625d006c766b51c300c36c766b51c351c3617c65a8006c766b53527ac46240006c766b51c300c36c766b51c351c3617c654e016c766b53527ac46223006c766b51c300c361653b026c766b53527ac4620e00006c766b53527ac46203006c766b53c3616c756652c56b6c766b00527ac46161681953797374656d2e53746f726167652e476574436f6e746578746c766b00c3617c681253797374656d2e53746f726167652e4765746c766b51527ac46203006c766b51c3616c756655c56b6c766b00527ac46c766b51527ac46161681953797374656d2e53746f726167652e476574436f6e746578746c766b00c3617c681253797374656d2e53746f726167652e4765746c766b52527ac46c766b52c300a06c766b53527ac46c766b53c3640e00006c766b54527ac4624c0061681953797374656d2e53746f726167652e476574436f6e746578746c766b00c36c766b51c3615272681253797374656d2e53746f726167652e50757461516c766b54527ac46203006c766b54c3616c756656c56b6c766b00527ac46c766b51527ac46161681953797374656d2e53746f726167652e476574436f6e746578746c766b00c3617c681253797374656d2e53746f726167652e4765746c766b52527ac46c766b52c3009c6c766b53527ac46c766b53c3640e00006c766b54527ac4628b006c766b52c361681b53797374656d2e52756e74696d652e436865636b5769746e657373009c6c766b55527ac46c766b55c3640e00006c766b54527ac4624c0061681953797374656d2e53746f726167652e476574436f6e746578746c766b00c36c766b51c3615272681253797374656d2e53746f726167652e50757461516c766b54527ac46203006c766b54c3616c756655c56b6c766b00527ac46161681953797374656d2e53746f726167652e476574436f6e746578746c766b00c3617c681253797374656d2e53746f726167652e4765746c766b51527ac46c766b51c3009c6c766b52527ac46c766b52c3640e00006c766b53527ac46288006c766b51c361681b53797374656d2e52756e74696d652e436865636b5769746e657373009c6c766b54527ac46c766b54c3640e00006c766b53527ac462490061681953797374656d2e53746f726167652e476574436f6e746578746c766b00c3617c681553797374656d2e53746f726167652e44656c65746561516c766b53527ac46203006c766b53c3616c7566
*/

func TestDomainSmartContract(ctx *testframework.TestFrameworkContext) bool {
	code := "02a600c56b6c766b00527ac46c766b51527ac461681953797374656d2e53746f726167652e476574436f6e74657874616c766b52527ac461682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616c766b53527ac46c766b00c30571756572799c64a8006c766b51c361c0519e643e00177175657279206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b52c36c766b54c37c61681253797374656d2e53746f726167652e476574616c766b55527ac46c766b55c351c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c75666c766b00c30872656769737465729c6488016c766b51c361c0529e6441001a7265676973746572206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b51c351c36c766b56527ac46c766b56c361681b53797374656d2e52756e74696d652e436865636b5769746e65737361009c643c00154e6f7420612076616c69646520616464726573732151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c36c766b54c37c61681253797374656d2e53746f726167652e476574616c766b57c39c645f006c766b52c36c766b54c36c766b56c3527261681253797374656d2e53746f726167652e5075746111726567697374657220737563636565642151c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c756613616c726561647920726567697374657265642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b00c30473656c6c9c640b026c766b51c361c0539e643d001673656c6c206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b51c351c36c766b56527ac46c766b51c352c36c766b58527ac46c766b56c361681b53797374656d2e52756e74696d652e436865636b5769746e65737361009c643c00154e6f7420612076616c69646520616464726573732151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c36c766b54c37c61681253797374656d2e53746f726167652e476574616c766b55527ac46c766b55c36c766b56c37c6165180f6c766b59527ac46c766b59c3009c6432000b4e6f74206f776e6572212051c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c36c766b54c36c766b53c3527261681253797374656d2e53746f726167652e507574616c766b52c30f4f726967696e616c5f4f776e65725f6c766b54c3936c766b56c3527261681253797374656d2e53746f726167652e507574616c766b52c30650726963655f6c766b54c3936c766b58c3527261681253797374656d2e53746f726167652e507574610d53656c6c20737563636565642151c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c75666c766b00c3036275799c64e1036c766b51c361c0539e643c0015627579206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b51c351c36c766b56527ac46c766b51c352c36c766b58527ac46c766b56c361681b53797374656d2e52756e74696d652e436865636b5769746e65737361009c643c00154e6f7420612076616c69646520616464726573732151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c36c766b54c37c61681253797374656d2e53746f726167652e476574616c766b55527ac46c766b55c36c766b53c37c6165040d6c766b59527ac46c766b59c3009c643a001375726c206973206e6f7420696e2073616c652051c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c30650726963655f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5a527ac46c766b5ac36c766b58c3a2644800215072696365206973206c6f776572207468616e2063757272656e7420707269636551c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c30354505f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5b527ac46c766b5bc36c766b57c39e645a006c766b53c36c766b5bc36c766b5ac3527261658a0c009c64400019726566756e6420746f207072656275796572206661696c656451c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b56c361681b53797374656d2e52756e74696d652e436865636b5769746e65737361009c643b0014436865636b5769746e65737320206661696c656451c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b56c36c766b53c36c766b58c352726165d20b519c6497006c766b52c30650726963655f6c766b54c3936c766b58c3527261681253797374656d2e53746f726167652e507574610e6265666f7265207365742054505f6c766b54c393043d3d3d3d9361681253797374656d2e52756e74696d652e4c6f67616c766b52c30354505f6c766b54c3936c766b56c3527261681253797374656d2e53746f726167652e5075746162030051616c7566157472616e73666572206f6e74206661696c6564212051c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75660d6275792073756363656564212051c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c75666c766b00c30d7175657279546f7050726963659c6414016c766b51c361c0519e6446001f7175657279546f705072696365206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b52c30650726963655f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5c527ac46c766b5cc36c766b57c39c641f000052c161681553797374656d2e52756e74696d652e4e6f74696679616c766b52c30354505f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5d527ac46c766b5dc36c766b5cc352c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c75666c766b00c3046465616c9c6430036c766b51c361c0529e643d00166465616c206172677320636f756e74206572726f722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b51c300c36c766b54527ac46c766b51c351c36c766b56527ac46c766b52c30f4f726967696e616c5f4f776e65725f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5e527ac46c766b5ec36c766b57c39c6446001f6465616c20676574204f726967696e616c5f4f776e6572206661696c65642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b5ec36c766b56c37c6165fd07009c6441001a6465616c206e6f7420746865206f726967696e206f776e65722151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c30650726963655f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b58527ac46c766b58c36c766b57c39c643d00166465616c20676574207072696365206661696c65642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c30354505f6c766b54c3937c61681253797374656d2e53746f726167652e476574616c766b5f527ac46c766b5fc36c766b57c39c643d00166465616c20676574206275796572206661696c65642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b53c36c766b5fc36c766b58c3527261655907009c6441001a6465616c207472616e73666572206f6e7420206661696c65642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c75666c766b52c30950726963655f75726c7c6168124e656f2e53746f726167652e44656c657465616c766b52c30f4f726967696e616c5f4f776e65725f6c766b54c3937c6168124e656f2e53746f726167652e44656c657465616c766b52c30354505f6c766b54c3937c6168124e656f2e53746f726167652e44656c657465616c766b52c36c766b54c36c766b5fc3527261680f4e656f2e53746f726167652e5075746162030051616c75666c766b00c307746573746d61709c64aa016c766b51c361c0529e6403006c766b51c300c36c766b0110527ac46c766b51c351c36c766b0111527ac461c76c766b0112527ac46c766b0112c36c766b0110c36c766b0111c3c46c766b0112c36c766b0110c3c36c766b0113527ac46c766b0113c351c161681553797374656d2e52756e74696d652e4e6f746966796107746573746b65796c766b0114527ac46c766b0112c36c766b0114c3097465737476616c7565c46c766b0112c36c766b0114c3c36c766b0115527ac46c766b0115c351c161681553797374656d2e52756e74696d652e4e6f74696679616c766b0112c3cc6c766b0116527ac46c766b0112c3cd6c766b0117527ac46c766b0117c3c06c766b0118527ac4006c766b0119527ac46c766b0119c36c766b0118c39f6482006c766b0116c36c766b0119c3c36c766b011a527ac46c766b0117c36c766b0119c3c36c766b011b527ac46c766b011ac351c161681553797374656d2e52756e74696d652e4e6f74696679616c766b011bc351c161681553797374656d2e52756e74696d652e4e6f74696679616c766b0119c351936c766b0119527ac46274ff62030051616c75666c766b00c3097465737461727261799c6431016c766b011cc35261c56c766b011d527ac46c766b011dc3000461616161c46c766b011dc3510462626262c451c161681553797374656d2e52756e74696d652e4e6f746966796151c161681553797374656d2e52756e74696d652e4e6f74696679616c766b011dc3cc6c766b011e527ac46c766b011dc3cd6c766b011f527ac46c766b011fc3c06c766b0120527ac4006c766b0121527ac46c766b0121c36c766b0120c39f6482006c766b011ec36c766b0121c3c36c766b0122527ac46c766b011fc36c766b0121c3c36c766b0123527ac46c766b0122c351c161681553797374656d2e52756e74696d652e4e6f74696679616c766b0123c351c161681553797374656d2e52756e74696d652e4e6f74696679616c766b0121c351936c766b0121527ac46274ff62030051616c75666c766b00c30a746573747374727563749c649c006152c66b0874657374746573746c766b00527ac404616661646c766b51527ac46c6c766b0123527ac46153c66b046a61636b6c766b00527ac45a6c766b51527ac46c6c766b0123c3517a6b6c766b52527ac46c6c766b0124527ac451c161681553797374656d2e52756e74696d652e4e6f746966796151c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c75666c766b00c30f7465737473747275637461727261799c6414016c766b0125c35261c56c766b0126527ac46152c66b036161616c766b00527ac4516c766b51527ac46c6c766b0123527ac46152c66b036262626c766b00527ac4526c766b51527ac46c6c766b0124527ac4133d3d3d7465737473747275637461727261793161680f4e656f2e52756e74696d652e4c6f67616c766b0126c3006c766b0123c3c46c766b0126c3516c766b0124c3c4133d3d3d7465737473747275637461727261793261680f4e656f2e52756e74696d652e4c6f67616c766b0126c300c300c36c766b0127527ac46c766b0127c351c161681553797374656d2e52756e74696d652e4e6f746966796151c161681553797374656d2e52756e74696d652e4e6f746966796162030051616c7566156e6f7420737570706f72746564206d6574686f642151c161681553797374656d2e52756e74696d652e4e6f746966796162030000616c756655c56b6c766b00527ac46c766b51527ac46c766b52527ac46c766b53527ac46203006c766b54c3616c756653c56b6c766b00527ac46c766b51527ac46c766b52527ac46c756652c56b6c766b00527ac46c766b51527ac46c756651c56b6c766b00527ac46c766b51527ac46203006c766b52c3616c756653c56b6c766b00527ac46c766b51527ac46c766b52527ac46c756651c56b6203006c766b00c3616c756651c56b6203006c766b00c3616c756651c56b6203006c766b52c3616c75665ac56b6c766b00527ac46c766b51527ac46c766b00c36c766b52c39c6419006c766b51c36c766b52c39c640b0062030051616c75666c766b00c361c06c766b51c361c09e640b0062030000616c7566006c766b53527ac46c766b53c36c766b00c361c09f6435006c766b00c36c766b53c3c36c766b51c36c766b53c3c39e640b0062030000616c75666c766b53c38b6c766b53527ac462c1ff62030051616c75665bc56b6c766b00527ac46c766b51527ac46c766b52527ac41400000000000000000000000000000000000000016c766b53527ac46153c66b6c6c766b00c3517a6b6c766b00527ac46c6c766b51c3517a6b6c766b51527ac46c6c766b52c3517a6b6c766b52527ac46c6c766b54527ac4516c766b55527ac46c766b54c351c1087472616e736665726c766b53c36c766b55c36168164f6e746f6c6f67792e4e61746976652e496e766f6b65616c766b56527ac46c766b56c36c766b57c39e6418006c766b56c300c301319c640b0062030051616c756662030000616c756662030051616c756651c56b6c766b00527ac46c756652c56b6c766b00527ac462030000616c756651c56b6c766b00527ac46c756651c56b6c766b00527ac46c7566"
	codeAddress, _ := utils.GetContractAddress(code)

	ctx.LogInfo("=====CodeAddress===%s", codeAddress.ToHexString())
	signer, err := ctx.GetDefaultAccount()
	if err != nil {
		ctx.LogError("TestDomainSmartContract GetDefaultAccount error:%s", err)
		return false
	}

	_, err = ctx.Ont.Rpc.DeploySmartContract(ctx.GetGasPrice(), ctx.GetGasLimit(),
		signer,
		true,
		code,
		"TestDomainSmartContract",
		"1.0",
		"",
		"",
		"",
	)

	if err != nil {
		ctx.LogError("TestDomainSmartContract DeploySmartContract error: %s", err)
	}

	//WaitForGenerateBlock
	_, err = ctx.Ont.Rpc.WaitForGenerateBlock(30*time.Second, 1)
	if err != nil {
		ctx.LogError("TestDomainSmartContract WaitForGenerateBlock error: %s", err)
		return false
	}

	_, err = ctx.Ont.Rpc.InvokeNeoVMContract(ctx.GetGasPrice(), ctx.GetGasLimit(),
		signer,
		codeAddress,
		[]interface{}{"Register", []interface{}{[]byte("ont.io"), []byte("onchain")}})
	if err != nil {
		ctx.LogError("TestDomainSmartContract InvokeNeoVMSmartContract error: %s", err)
	}

	//WaitForGenerateBlock
	_, err = ctx.Ont.Rpc.WaitForGenerateBlock(30*time.Second, 1)
	if err != nil {
		ctx.LogError("TestDomainSmartContract WaitForGenerateBlock error: %s", err)
		return false
	}

	svalue, err := ctx.Ont.Rpc.GetStorage(codeAddress, []byte("ont.io"))
	if err != nil {
		ctx.LogError("TestDomainSmartContract GetStorageItem key:hello error: %s", err)
		return false
	}

	ctx.LogInfo("==svalue = %v", string(svalue))

	err = ctx.AssertToString(string(svalue), "onchain")
	if err != nil {
		ctx.LogError("TestDomainSmartContract AssertToString error: %s", err)
		return false
	}

	return true
}